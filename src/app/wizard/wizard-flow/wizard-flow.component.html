<!-- Fondo con imagen de ciudad -->
<div class="wizard-background">
  <div class="city-background"></div>
</div>

<div class="wizard-flow">
  <div class="wizard-header">
    <div class="wizard-progress">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="((currentStep + 1) / steps.length) * 100"></div>
      </div>
      <div class="step-indicators">
        <div 
          *ngFor="let step of steps; let i = index" 
          class="step-indicator"
          [class.active]="i === currentStep"
          [class.completed]="i < currentStep"
        >
          <span class="step-number">{{ i + 1 }}</span>
          <span class="step-label">{{ step.label }}</span>
        </div>
      </div>
    </div>
    
    <!-- Botón cerrar -->
    <button class="close-button" (click)="closeWizard()" title="Cerrar wizard" [disabled]="loadingRestart">
      <span *ngIf="loadingRestart" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      <svg *ngIf="!loadingRestart" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="wizard-content">
    <!-- Welcome Step -->
    <app-welcome-step 
      *ngIf="currentStep === 0"
      (next)="setCurrentStep(1)">
    </app-welcome-step>

    <!-- Main Data Step -->
    <app-main-data-step
      *ngIf="currentStep === 1"
      [selectedPlan]="selectedPlan"
      (next)="onNextAndPay($event)"
      (previous)="setCurrentStep(0)"
      (goToFinish)="onQuotationSentByEmail($event)">
    </app-main-data-step>

    <!-- Payment Step -->
    <app-payment-step 
      *ngIf="currentStep === 2"
      [quotationId]="quotationId || undefined"
      [quotationData]="currentQuotation"
      [userId]="userId || undefined"
      (next)="onPaymentCompleted($event)"
      (previous)="prevStep()"
      (goToFinish)="onQuotationSentByEmail($event)">
    </app-payment-step>

    <!-- Validation Step -->
    <app-validation-step
      *ngIf="currentStep === 3"
      [validationStatus]="validationStatus"
      (next)="setCurrentStep(4)"
      (selectPlan)="onValidationSelectPlan($event)"
      (goToStart)="onValidationGoToStart()"
    ></app-validation-step>

    <!-- Buro de Crédito Step -->
    <app-buro-credito-step
      *ngIf="currentStep === 4"
      (next)="setCurrentStep(5)"
      (previous)="setCurrentStep(3)">
    </app-buro-credito-step>

    <!-- Data Entry Step -->
    <app-data-entry-step
      *ngIf="currentStep === 5"
      (next)="onDataEntryCompleted()"
      (previous)="setCurrentStep(4)">
    </app-data-entry-step>

    <!-- Contract Step -->
    <app-contract-step
      *ngIf="currentStep === 6"
      (next)="nextStep()"
      (previous)="prevStep()"
    ></app-contract-step>

    <!-- Finish Step -->
    <app-finish-step
      *ngIf="currentStep === 7"
      [quotationSentByEmail]="quotationSentByEmail"
      [quotationNumber]="quotationNumber"
      (goToStart)="onFinishGoToStart()">
    </app-finish-step>
  </div>

  <!-- Modal para continuar wizard -->
  <app-continue-wizard-modal
    *ngIf="showContinueModal"
    [show]="showContinueModal"
    [currentStep]="modalCurrentStep"
    [selectedPlan]="modalSelectedPlan"
    [selectedPlanName]="modalSelectedPlanName"
    [quotationNumber]="modalQuotationNumber"
    [policyNumber]="modalPolicyNumber"
    [completedSteps]="modalCompletedSteps"
    (continue)="onContinueWizard()"
    (restart)="onRestartWizard()">
  </app-continue-wizard-modal>

  <!-- Diálogo de confirmación para reiniciar -->
  <app-confirm-dialog
    [show]="showConfirmDialog"
    [title]="confirmDialogTitle"
    [message]="confirmDialogMessage"
    [warning]="confirmDialogWarning"
    (confirm)="onConfirmRestart()"
    (cancel)="onCancelRestart()">
  </app-confirm-dialog>
</div>
